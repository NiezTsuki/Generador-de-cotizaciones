<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador JAPE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { 
            --primary: #D32F2F; /* Rojo JAPE */
            --primary-dark: #b71c1c;
            --dark: #1a1a1a; 
            --gray: #666666;
            --border: #cccccc;
            --bg: #f4f6f8;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); 
            margin: 0; 
            padding: 30px 20px; 
            color: var(--dark); 
            font-size: 18px; /* Letra base GRANDE para buena visibilidad */
            line-height: 1.5;
        }

        .container { 
            max-width: 950px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            border-radius: 10px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); /* Sombra suave */
            border: 1px solid #e0e0e0;
        }

        /* T√çTULO */
        h1 { 
            color: var(--primary); 
            text-align: center; 
            margin-bottom: 35px; 
            font-size: 2.4rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
        }

        /* SECCIONES */
        .section-title { 
            font-size: 1.2rem; 
            font-weight: 800; 
            color: var(--dark); 
            margin-top: 40px; 
            margin-bottom: 15px; 
            text-transform: uppercase; 
            display: flex;
            align-items: center;
        }
        .section-title::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 24px;
            background-color: var(--primary);
            margin-right: 10px;
            border-radius: 2px;
        }

        /* PANEL DE CONTROL (REDISE√ëADO - BLANCO Y LIMPIO) */
        .control-panel { 
            background: #ffffff; 
            padding: 25px; 
            border-radius: 8px; 
            margin-bottom: 40px; 
            border: 1px solid #d0d0d0; /* Borde gris sutil */
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .panel-title {
            margin: 0;
            font-size: 1.3rem;
            color: #444;
            font-weight: 700;
        }

        /* INPUTS (Grandes y claros) */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .form-group { margin-bottom: 25px; }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 700; 
            font-size: 1rem; 
            color: #333; 
        }

        input, select, textarea { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #ccc; 
            border-radius: 6px; 
            font-size: 1.1rem; 
            color: #000;
            box-sizing: border-box; 
            transition: border 0.2s;
            background-color: #fff;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus { 
            border-color: var(--primary); 
            outline: none; 
            background-color: #fffbfc;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1); 
        }

        textarea { resize: vertical; min-height: 80px; }

        /* BOTONES */
        button { cursor: pointer; font-family: inherit; font-weight: 700; transition: all 0.2s; }
        
        .btn { 
            padding: 12px 24px; 
            border-radius: 6px; 
            border: none; 
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-save { background-color: #333; color: white; }
        .btn-save:hover { background-color: #000; }

        .btn-new { background-color: #fff; border: 2px solid #333; color: #333; }
        .btn-new:hover { background-color: #f0f0f0; }

        .btn-generate { 
            background-color: var(--primary); 
            color: white; 
            width: 100%; 
            padding: 18px; 
            font-size: 1.3rem; 
            margin-top: 40px;
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3);
        }
        .btn-generate:hover { background-color: var(--primary-dark); transform: translateY(-2px); }

        .btn-outline { 
            background-color: transparent; 
            border: 2px dashed #999; 
            color: #555; 
            padding: 15px;
            width: 100%;
            margin-top: 20px;
            font-size: 1.1rem;
        }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); background-color: #fffdfd; }

        /* TABLA DE ITEMS */
        .items-header { 
            display: grid; 
            grid-template-columns: 4fr 1fr 1.5fr 1.5fr auto; 
            gap: 15px; 
            padding: 15px; 
            background-color: #212121; 
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .items-list { display: flex; flex-direction: column; gap: 15px; }

        .item-row { 
            display: grid; 
            grid-template-columns: 4fr 1fr 1.5fr 1.5fr auto; 
            gap: 15px; 
            padding: 15px;
            border: 1px solid #ddd;
            border-left: 5px solid #ccc; /* Indicador visual izquierdo */
            border-radius: 4px;
            background: white;
            align-items: start;
        }
        .item-row:focus-within { border-left-color: var(--primary); }

        .btn-remove { 
            background: #ffebee; 
            color: #d32f2f; 
            border: 1px solid #ef5350; 
            width: 45px; height: 45px; 
            border-radius: 6px;
            font-size: 1.5rem; 
            display: flex; align-items: center; justify-content: center;
        }
        .btn-remove:hover { background: #d32f2f; color: white; }

        /* TOTALES */
        .totals-container { 
            margin-top: 40px; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
            padding: 20px;
            background: #fafafa;
            border-top: 2px solid #eee;
        }

        .total-line { 
            display: flex; justify-content: space-between; width: 100%; max-width: 400px;
            margin-bottom: 12px; font-size: 1.1rem; color: #555; font-weight: 600;
        }

        .total-final { 
            font-size: 1.8rem; font-weight: 800; color: var(--primary); 
            margin-top: 10px; padding-top: 15px; border-top: 2px solid #ddd;
        }

        .checkbox-wrapper { 
            display: flex; align-items: center; justify-content: flex-end; 
            margin-bottom: 20px; cursor: pointer; font-size: 1.1rem; font-weight: bold;
        }
        .checkbox-wrapper input { width: 25px; height: 25px; margin-right: 12px; }

        /* Estilo Select Historial */
        #historialSelect {
            font-family: monospace; 
            font-size: 1rem;
            border-color: #bbb;
        }

        /* RESPONSIVE */
        @media (max-width: 850px) { 
            .grid-2 { grid-template-columns: 1fr; } 
            .items-header { display: none; }
            .item-row { grid-template-columns: 1fr; border-left: none; border-bottom: 5px solid #ccc; }
            .panel-header { flex-direction: column; align-items: stretch; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>COTIZADOR JAPE</h1>

    <div class="control-panel">
        <div class="panel-header">
            <h3 class="panel-title">üìÇ Gesti√≥n de Archivos</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="guardarCotizacion()" class="btn btn-save">üíæ Guardar Progreso</button>
                <button onclick="limpiarFormulario()" class="btn btn-new">‚ú® Empezar Nueva</button>
            </div>
        </div>
        
        <div style="background: #f9f9f9; padding: 15px; border: 1px solid #eee; border-radius: 6px;">
            <label style="margin-bottom: 10px; font-size: 0.9rem; text-transform: uppercase; color: #666;">Cargar Cotizaci√≥n Anterior:</label>
            <div style="display: flex; gap: 10px;">
                <select id="historialSelect" onchange="cargarCotizacionSeleccionada()">
                    <option value="">-- Seleccionar --</option>
                </select>
                <button onclick="borrarCotizacionGuardada()" class="btn-remove" style="width: auto; padding: 0 20px; font-size: 1rem; height: auto;">Borrar</button>
            </div>
        </div>
    </div>

    <div class="section-title">1. Datos del Cliente</div>
    <div class="grid-2">
        <div class="form-group">
            <label>Nombre Completo / Empresa</label>
            <input type="text" id="clienteNombre" placeholder="Ej: Juan P√©rez">
        </div>
        <div class="form-group">
            <label>Tel√©fono (Formato Autom√°tico)</label>
            <input type="tel" id="clienteTelefono" placeholder="6000-0000" maxlength="9"> 
        </div>
    </div>

    <div class="form-group">
        <label>Identificaci√≥n</label>
        <div style="display: flex; gap: 15px;">
            <select id="tipoId" style="width: 120px; flex-shrink: 0;">
                <option value="CIP">CIP</option>
                <option value="RUC">RUC</option>
                <option value="ID">ID</option>
            </select>
            <input type="text" id="clienteId" placeholder="N√∫mero de ID">
        </div>
    </div>

    <div class="form-group">
        <label>Direcci√≥n F√≠sica</label>
        <input type="text" id="clienteDireccion" placeholder="Ubicaci√≥n...">
    </div>

    <div class="section-title">2. Detalles del Documento</div>
    <div class="grid-2">
        <div class="form-group">
            <label>N√∫mero de Cotizaci√≥n</label>
            <input type="text" id="numCotizacion" value="COT-001" style="font-weight: 800; color: var(--primary); background-color: #fff;">
        </div>
        <div class="form-group">
            <label>Tiempo de Validez</label>
            <input type="text" id="validez" value="15 D√≠as H√°biles">
        </div>
    </div>

    <div class="section-title">3. Descripci√≥n de Servicios</div>
    
    <div class="items-header">
        <div>Descripci√≥n</div>
        <div style="text-align: center;">Cant.</div>
        <div style="text-align: right;">Precio ($)</div>
        <div style="text-align: right;">Total</div>
        <div></div>
    </div>

    <div class="items-list" id="itemsList">
        </div>

    <button class="btn btn-outline" onclick="agregarItem()">
        + Agregar l√≠nea de servicio
    </button>

    <div class="totals-container">
        <label class="checkbox-wrapper">
            <input type="checkbox" id="checkITBMS" onchange="calcularTotales()">
            <span>Aplicar Impuesto (ITBMS 7%)</span>
        </label>

        <div class="total-line">
            <span>Subtotal:</span>
            <span id="txtSubtotal">$0.00</span>
        </div>
        <div class="total-line" id="rowITBMS" style="display: none;">
            <span>ITBMS (7%):</span>
            <span id="txtITBMS">$0.00</span>
        </div>
        <div class="total-line total-final">
            <span>TOTAL A PAGAR:</span>
            <span id="txtTotal">$0.00</span>
        </div>
    </div>

    <div class="section-title">4. Notas / Observaciones</div>
    <textarea id="notas" rows="3">Cotizaci√≥n v√°lida por 15 d√≠as h√°biles. Precios sujetos a cambios sin previo aviso.</textarea>

    <button class="btn btn-generate" onclick="generarPDF()">
        üìÑ DESCARGAR PDF
    </button>
</div>

<script>
    let items = [];
    const LOGO_URL = './logo2.png'; 
    const STORAGE_KEY = 'jape_cotizaciones_v5_final';

    document.addEventListener('DOMContentLoaded', () => { 
        agregarItem(); 
        actualizarSelectHistorial(); 
        setupMasks(); 
    });

    // --- M√ÅSCARAS ---
    function setupMasks() {
        const telInput = document.getElementById('clienteTelefono');
        telInput.addEventListener('input', function (e) {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,4})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : x[1] + '-' + x[2];
        });
    }

    // --- GESTI√ìN DE HISTORIAL DETALLADO ---
    function guardarCotizacion() {
        const numCot = document.getElementById('numCotizacion').value;
        if(!numCot) { alert("Falta el n√∫mero de cotizaci√≥n"); return; }

        const now = new Date();
        const cotizacion = {
            id: numCot, 
            fecha: now.toLocaleDateString(),
            hora: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            datos: {
                nombre: document.getElementById('clienteNombre').value,
                telefono: document.getElementById('clienteTelefono').value,
                tipoId: document.getElementById('tipoId').value,
                clienteId: document.getElementById('clienteId').value,
                direccion: document.getElementById('clienteDireccion').value,
                numCotizacion: numCot,
                validez: document.getElementById('validez').value,
                notas: document.getElementById('notas').value,
                checkITBMS: document.getElementById('checkITBMS').checked
            },
            items: items
        };

        let historial = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        historial[numCot] = cotizacion;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(historial));
        actualizarSelectHistorial();
        
        const btn = document.querySelector('.btn-save');
        const original = btn.innerHTML;
        btn.innerHTML = "‚úÖ Guardado";
        setTimeout(() => btn.innerHTML = original, 1500);
    }

    function actualizarSelectHistorial() {
        const historial = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        const select = document.getElementById('historialSelect');
        const current = select.value;
        select.innerHTML = '<option value="">-- Seleccionar cotizaci√≥n guardada --</option>';

        Object.values(historial).reverse().forEach(c => {
            const option = document.createElement('option');
            option.value = c.id;
            const nombreCliente = c.datos.nombre ? c.datos.nombre : "Sin Nombre";
            const fechaHora = c.fecha ? `(${c.fecha} ${c.hora})` : "";
            option.text = `${c.id} | ${nombreCliente} ${fechaHora}`;
            select.appendChild(option);
        });
        
        if(historial[current]) select.value = current;
    }

    function cargarCotizacionSeleccionada() {
        const id = document.getElementById('historialSelect').value;
        if (!id) return;
        const h = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        const c = h[id];
        if (c) {
            document.getElementById('clienteNombre').value = c.datos.nombre || '';
            document.getElementById('clienteTelefono').value = c.datos.telefono || '';
            document.getElementById('tipoId').value = c.datos.tipoId;
            document.getElementById('clienteId').value = c.datos.clienteId || '';
            document.getElementById('clienteDireccion').value = c.datos.direccion || '';
            document.getElementById('numCotizacion').value = c.datos.numCotizacion;
            document.getElementById('validez').value = c.datos.validez;
            document.getElementById('notas').value = c.datos.notas;
            document.getElementById('checkITBMS').checked = c.datos.checkITBMS;
            items = JSON.parse(JSON.stringify(c.items));
            renderItems();
            calcularTotales();
        }
    }

    function borrarCotizacionGuardada() {
        const id = document.getElementById('historialSelect').value;
        if(!id) return;
        if(confirm(`¬øBorrar definitivamente la cotizaci√≥n ${id}?`)) {
            let h = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            delete h[id];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(h));
            limpiarFormulario();
            actualizarSelectHistorial();
        }
    }

    function limpiarFormulario() {
        document.getElementById('clienteNombre').value = '';
        document.getElementById('clienteTelefono').value = '';
        document.getElementById('clienteId').value = '';
        document.getElementById('clienteDireccion').value = '';
        document.getElementById('numCotizacion').value = 'COT-' + Math.floor(1000 + Math.random() * 9000);
        document.getElementById('historialSelect').value = "";
        document.getElementById('checkITBMS').checked = false;
        items = [];
        agregarItem();
        calcularTotales();
    }

    // --- ITEMS ---
    function agregarItem() {
        const id = Date.now();
        items.push({ id, descripcion: '', cantidad: 1, precio: 0 });
        renderItems();
    }

    function eliminarItem(id) {
        if (items.length > 0) {
            const index = items.findIndex(i => i.id === id);
            items.splice(index, 1);
            renderItems();
            calcularTotales();
        }
        if (items.length === 0) agregarItem();
    }

    function updateItem(id, field, value) {
        const item = items.find(i => i.id === id);
        if (item) {
            if (field === 'cantidad' || field === 'precio') {
                item[field] = parseFloat(value) || 0;
            } else {
                item[field] = value;
            }
            const totalSpan = document.getElementById(`total-${item.id}`);
            if (totalSpan) totalSpan.innerText = `$${(item.cantidad * item.precio).toFixed(2)}`;
            calcularTotales();
        }
    }

    function formatPriceOnBlur(input) {
        let val = parseFloat(input.value);
        if(!isNaN(val)) input.value = val.toFixed(2);
    }

    function renderItems() {
        const container = document.getElementById('itemsList');
        container.innerHTML = '';

        items.forEach(item => {
            const row = document.createElement('div');
            row.className = 'item-row';
            row.innerHTML = `
                <div style="width:100%">
                    <label style="font-size:0.8rem; color:#666; margin-bottom:2px;">Descripci√≥n:</label>
                    <textarea placeholder="Detalle del servicio..." 
                        oninput="updateItem(${item.id}, 'descripcion', this.value)">${item.descripcion}</textarea>
                </div>
                
                <div>
                    <label style="font-size:0.8rem; color:#666; text-align:center; display:block;">Cant.</label>
                    <input type="number" style="text-align: center; font-weight:bold;" value="${item.cantidad}" 
                        oninput="updateItem(${item.id}, 'cantidad', this.value)">
                </div>
                
                <div>
                    <label style="font-size:0.8rem; color:#666; text-align:right; display:block;">Precio ($)</label>
                    <input type="number" style="text-align: right; font-weight:bold;" value="${item.precio}" 
                        onblur="formatPriceOnBlur(this)"
                        oninput="updateItem(${item.id}, 'precio', this.value)">
                </div>
                
                <div style="font-weight:900; font-size:1.2rem; text-align:right; align-self: center; color: var(--primary);" id="total-${item.id}">
                    $${(item.cantidad * item.precio).toFixed(2)}
                </div>
                
                <button class="btn-remove" onclick="eliminarItem(${item.id})" title="Eliminar fila" style="align-self: center;">&times;</button>
            `;
            container.appendChild(row);
        });
    }

    function calcularTotales() {
        const subtotal = items.reduce((sum, item) => sum + (item.cantidad * item.precio), 0);
        const aplicaITBMS = document.getElementById('checkITBMS').checked;
        const itbms = aplicaITBMS ? subtotal * 0.07 : 0;
        const total = subtotal + itbms;
        
        document.getElementById('txtSubtotal').innerText = `$${subtotal.toFixed(2)}`;
        document.getElementById('txtITBMS').innerText = `$${itbms.toFixed(2)}`;
        document.getElementById('txtTotal').innerText = `$${total.toFixed(2)}`;
        document.getElementById('rowITBMS').style.display = aplicaITBMS ? 'flex' : 'none';
    }

    // --- PDF GENERATOR ---
    async function generarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const C_PRIMARY = [198, 40, 40]; 
        const C_DARK = [10, 10, 10];
        const C_GRAY = [80, 80, 80];

        // Header
        const headerHeight = 40; 
        doc.setFillColor(...C_DARK); doc.rect(0, 0, 210, headerHeight, 'F');

        try {
            const img = new Image(); img.src = LOGO_URL;
            await new Promise((resolve) => { img.onload = resolve; img.onerror = resolve; });
            if (img.width > 0) doc.addImage(img, 'PNG', 15, 10, 20, 20); 
            else { doc.setFontSize(22); doc.setTextColor(255); doc.text("JAPE", 15, 22); }
        } catch (e) { }

        doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.setTextColor(255, 255, 255);
        doc.text("MULTISERVICES JAPE", 195, 15, { align: "right" });
        doc.setFontSize(10); doc.setFont("helvetica", "normal");
        doc.text("Servicios Generales y Mantenimiento", 195, 21, { align: "right" });
        doc.text("Panam√° | +507 6178-9785", 195, 26, { align: "right" });

        doc.setFillColor(...C_PRIMARY); doc.rect(0, headerHeight, 210, 2, 'F');

        let y = headerHeight + 20;
        doc.setFontSize(20); doc.setFont("helvetica", "bold"); doc.setTextColor(...C_PRIMARY);
        doc.text("COTIZACI√ìN", 15, y);

        y += 15;
        doc.setFontSize(11); doc.setTextColor(...C_GRAY); doc.setFont("helvetica", "bold");
        doc.text("FACTURAR A:", 15, y);
        doc.setFont("helvetica", "normal"); doc.setTextColor(0, 0, 0);
        
        y += 6;
        const nombre = document.getElementById('clienteNombre').value || 'Cliente General';
        doc.setFontSize(12); doc.text(nombre.toUpperCase(), 15, y);
        
        y += 6; doc.setFontSize(10);
        const tel = document.getElementById('clienteTelefono').value;
        if(tel) { doc.text(`Tel: ${tel}`, 15, y); y += 5; }
        
        const tipoId = document.getElementById('tipoId').value;
        const numId = document.getElementById('clienteId').value;
        if(numId) { doc.text(`${tipoId}: ${numId}`, 15, y); y += 5; }
        
        const dir = document.getElementById('clienteDireccion').value;
        if(dir) { doc.text(dir, 15, y); }

        y = headerHeight + 35;
        doc.setFont("helvetica", "bold"); doc.setTextColor(...C_GRAY);
        doc.text("N¬∫ COTIZACI√ìN:", 160, y, { align: "right" });
        doc.setTextColor(0,0,0); doc.text(document.getElementById('numCotizacion').value, 195, y, { align: "right" });
        
        y += 7;
        doc.setTextColor(...C_GRAY); doc.text("FECHA:", 160, y, { align: "right" });
        doc.setTextColor(0,0,0); doc.text(new Date().toLocaleDateString('es-PA'), 195, y, { align: "right" });

        y += 7;
        doc.setTextColor(...C_GRAY); doc.text("VALIDEZ:", 160, y, { align: "right" });
        doc.setTextColor(0,0,0); doc.text(document.getElementById('validez').value, 195, y, { align: "right" });

        const tableBody = items.map(item => [
            item.descripcion,
            item.cantidad,
            `$${item.precio.toFixed(2)}`,
            `$${(item.cantidad * item.precio).toFixed(2)}`
        ]);

        doc.autoTable({
            startY: y + 25,
            head: [['DESCRIPCI√ìN', 'CANT.', 'PRECIO U.', 'TOTAL']],
            body: tableBody,
            theme: 'grid',
            headStyles: { fillColor: C_DARK, textColor: 255, fontStyle: 'bold' },
            styles: { fontSize: 10, cellPadding: 5, valign: 'middle' },
            columnStyles: { 0: { cellWidth: 100 }, 1: { halign: 'center' }, 2: { halign: 'right' }, 3: { halign: 'right', fontStyle: 'bold' } }
        });

        let finalY = doc.lastAutoTable.finalY + 10;
        const subtotal = items.reduce((s, i) => s + (i.cantidad * i.precio), 0);
        const aplicaITBMS = document.getElementById('checkITBMS').checked;
        const itbms = aplicaITBMS ? subtotal * 0.07 : 0;
        const total = subtotal + itbms;

        if (finalY > 230) { doc.addPage(); finalY = 20; }

        doc.setFontSize(11);
        doc.setTextColor(...C_GRAY); doc.text("Subtotal:", 130, finalY);
        doc.setTextColor(0); doc.text(`$${subtotal.toFixed(2)}`, 195, finalY, { align: "right" });
        finalY += 8;

        if (aplicaITBMS) {
            doc.setTextColor(...C_GRAY); doc.text("ITBMS (7%):", 130, finalY);
            doc.setTextColor(0); doc.text(`$${itbms.toFixed(2)}`, 195, finalY, { align: "right" });
            finalY += 8;
        }

        doc.setDrawColor(0); doc.line(130, finalY, 195, finalY); finalY += 6;
        doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.setTextColor(...C_PRIMARY);
        doc.text("TOTAL:", 130, finalY + 2);
        doc.text(`$${total.toFixed(2)}`, 195, finalY + 2, { align: "right" });

        // --- FOOTER CON DATOS DE PAGO EXACTOS ---
        const footerY = doc.internal.pageSize.height - 40;
        doc.setFontSize(9); doc.setTextColor(0);
        doc.setFont("helvetica", "bold");
        doc.text('DATOS DE PAGO:', 15, footerY);
        
        doc.setFont("helvetica", "normal");
        // L√≠nea 1: Nombre
        doc.text('EFECTIVO, CHEQUE O ACH A NOMBRE DE: JOSE ANTONIO PEREZ', 15, footerY + 5);
        // L√≠nea 2: Banco General
        doc.text('BANCO GENERAL CUENTA DE AHORRO 0499972235318', 15, footerY + 10);
        // L√≠nea 3: Banco BAC
        doc.text('BANCO BAC N 11696130', 15, footerY + 15);
        
        doc.setFont("helvetica", "bold");
        doc.text("NOTAS:", 15, footerY + 23);
        doc.setFont("helvetica", "normal");
        doc.text(document.getElementById('notas').value, 15, footerY + 28, { maxWidth: 180 });

        doc.save(`Cotizacion-${document.getElementById('numCotizacion').value}.pdf`);
    }
</script>

</body>
</html>